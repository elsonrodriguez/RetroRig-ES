#!/bin/bash
#
# RetroRig emulator modules
# This is a small script to copy over configuration files for emulators
# append a "-x" on the end above for debugging if need be
# Please report any errors via a pull request
# You can also reach me on twitter: @N3RD42
#

function em_add_debian_repos()
{
	# Note: system update for repos occurs in rrs_software
	
	# NOTE: The ppa:mdeguzis/retrorig PPA is added in rrs_add_standard_repos
	# We want to maintain as little as possible to decrease overhead
	

	case $OS_TYPE in
		"Ubuntu")

			case $OS_RELEASE in

				14.04)
					$cmd_add_repo ppa:gregory-hainaut/pcsx2.official.ppa
					$cmd_add_repo ppa:glennric/dolphin-emu
					$cmd_add_repo ppa:ppsspp/stable
					$cmd_add_repo ppa:libretro/stable
					;;
					
				15.04)
					$cmd_add_repo ppa:gregory-hainaut/pcsx2.official.ppa
					$cmd_add_repo ppa:glennric/dolphin-emu
					$cmd_add_repo ppa:ppsspp/stable
					$cmd_add_repo ppa:libretro/stable
					;;

				*)
					;;
			esac
		;;

		LinuxMint)

			case $OS_RELEASE in
				"17")
					$cmd_add_repo ppa:gregory-hainaut/pcsx2.official.ppa
					$cmd_add_repo ppa:glennric/dolphin-emu
					$cmd_add_repo ppa:ppsspp/stable
					$cmd_add_repo ppa:libretro/stable
					;;

				*)
					;;
			esac
		;;
	
		Deepin)

			case $OS_RELEASE in
				"2014")
					$cmd_add_repo ppa:gregory-hainaut/pcsx2.official.ppa
					$cmd_add_repo ppa:glennric/dolphin-emu
					$cmd_add_repo ppa:ppsspp/stable
					$cmd_add_repo ppa:libretro/stable	
				;;
			esac
		;;
		
	esac

}

function_set_emu_pkg()
{
	
	#####################################################################
	# Process package names and types
	# Add available repos in em_add_debian_repos()
	#####################################################################
	
	case $OS_TYPE in
		"Ubuntu")

			case $OS_RELEASE in

				14.04)
					PKG_higan="higan"
					PKG_retroarch="retroarch"
					PKG_scummvm="libretro-scummvm"
					PKG_4DO="libretro-4do"
					PKG_virtualboy="libretro-beetle-vb"
					PKG_wswan="libretro-beetle-wswan"
					PKG_dolphin="dolphin-emu-master"
					PKG_desmume="libretro-desmume"
					PKG_gens="gens"
					PKG_mame="mame"
					PKG_mess="mess"
					PKG_pcsx2="pcsx2"
					PKG_ppsspp="ppsspp"
					PKG_stella="stella"
					;;
					
				15.04)
					PKG_higan="higan"
					PKG_retroarch="retroarch"
					PKG_scummvm="libretro-scummvm"
					PKG_4DO="libretro-4do"
					PKG_virtualboy="libretro-beetle-vb"
					PKG_wswan="libretro-beetle-wswan"
					PKG_dolphin="dolphin-emu-master"
					PKG_desmume="libretro-desmume"
					PKG_gens="gens"
					PKG_mame="mame"
					PKG_mess="mess"
					PKG_pcsx2="pcsx2"
					PKG_ppsspp="ppsspp"
					PKG_stella="stella"
					;;

				*)
					;;
			esac
		;;

		LinuxMint)

			case $OS_RELEASE in
				"17")
					PKG_higan="higan"
					PKG_retroarch="retroarch"
					PKG_scummvm="libretro-scummvm"
					PKG_4DO="libretro-4do"
					PKG_virtualboy="libretro-beetle-vb"
					PKG_wswan="libretro-beetle-wswan"
					PKG_dolphin="dolphin-emu-master"
					PKG_desmume="libretro-desmume"
					PKG_gens="gens"
					PKG_mame="mame"
					PKG_mess="mess"
					PKG_pcsx2="pcsx2"
					PKG_ppsspp="ppsspp"
					PKG_stella="stella"
					;;

				*)
					;;
			esac
		;;
	
		Deepin)

			case $OS_RELEASE in
				"2014")
					PKG_higan="higan"
					PKG_retroarch="retroarch"
					PKG_scummvm="libretro-scummvm"
					PKG_4DO="libretro-4do"
					PKG_virtualboy="libretro-beetle-vb"
					PKG_wswan="libretro-beetle-wswan"
					PKG_dolphin="dolphin-emu-master"
					PKG_desmume="libretro-desmume"
					PKG_gens="gens"
					PKG_mame="mame"
					PKG_mess="mess"
					PKG_pcsx2="pcsx2"
					PKG_ppsspp="ppsspp"
					PKG_stella="stella"
				;;
			esac
		;;
		
	esac

	
}

function em_install_deb_emulators()
{

	#####################################################################
	# Process package names and types based on OS/Release
	#####################################################################

	function_set_emu_pkg

	#####################################################################
	# Retroarch Unstable / Testing Cores
	#####################################################################

	# At the moment, only 32-bit is compiled sucessfully by 
	# the libretro testing PPA team. 
	# Imported to RetroRig-ES PPA 20150512'
	
	echo "Installing Scummvm emulator"
	
	# Install scummvm emulator from the RetroRig-PPA
	$cmd_install_pkg $PKG_scummvm

	#####################################################################
	# 3DO (libretro 4DO core)
	#####################################################################
	
	echo "Installing 3DO emulator 4DO"
	
	# install from libretro-stable PPA
	$cmd_install_pkg $PKG_4DO
	
	#####################################################################
	# Retroarch (used for libretro cores)
	#####################################################################

	echo "Installing emulator front-end Retroarch"
	
	# Install via libretro stable
	$cmd_install_pkg $PKG_retroarch
	
	#####################################################################
	# Beetle (libretro beetle-vb core)
	#####################################################################
	
	# Install Beetle for Virtual Boy
	echo "Installing Virtual Boy emulator Beetle-VB"

	# Install via libretro stable
	$cmd_install_pkg $PKG_virtualboy

	#####################################################################
	# Beetle (libretro Bandai Wonderswan core)
	#####################################################################
	
	echo "Installing Bandai Wonderswan emulator Beetle-Wswan"
	
	# Install from libretro-stable PPA
	$cmd_pkg_install $PKG_libretro-beetle-wswan

	#####################################################################
	# Dolphin (Nintendo Gamecube)
	#####################################################################

	echo "Installing Nintendo Gamecube emulator Dolphin"
	# Note: Glenric's PPA uses dolphin-emu-master, not dolphin-emu for
	# Trusty/Vivid. Otherwise install dolphin-emu

	# Install via Glenric's PPA
	$cmd_install_pkg $PKG_dolphin

	#####################################################################
	# DesMuMe (libretro core)
	#####################################################################

	# Install front-end Retroarch
	echo "Installing Nintendo DS emulator libretro-desmume "

	# Install desmume core
	# Use libretro* for all packages
	
	# Install from hunter-kaller PPA
	$cmd_install_pkg $PKG_desmume

	#####################################################################
	# Gens (Genesis/Sega CD/Saturn)
	#####################################################################

	echo "Installing Gens Sega Genesis/CD/32X emulator"
	
	# Install via RetroRig PPA
	$cmd_install_pkg $PKG_gens

	#####################################################################
	# Mupen64plus (Sega Saturn)
	#####################################################################
	
	echo "Installing mupen64plus emulator"
	
	# Installed via RetroRig PPA. Core repo pkg is still old.
	$cmd_install_pkg $PKG_mupen64plus

	#####################################################################
	# MAME (multi-system)
	#####################################################################

	echo "Installing MAME emulator"
	
	# Install via core repos (kept up to date as of 20150512)
	$cmd_install_pkg $PKG_mame

	#####################################################################
	# Mednafen (multi-system)
	#####################################################################

	echo "Installing Mednafen emulator"
	
	# Install via core repos
	$cmd_install_pkg $PKG_mednafen

	#####################################################################
	# MESS (multi-system)
	#####################################################################

	echo "Installing MESS emulator"
	
	# Installed via core repos (kept up to date as of 20150107)
	$cmd_install_pkg $PKG_mess

	#####################################################################
	# PCSX2 (Playstation 2)
	#####################################################################

        # Install from gregory-hainaut PPA
	echo "Installing Playstation 2 emulator PCSX2"
	$cmd_install_pkg $PKG_pcsx2

	# Prerequisites
	$cmd_install_pkg libportaudio2:i386 libjack-jackd2-0:i386
  
	# Link BIOS path from home/RetroRig (source) to .retrorig/
	ln -sf "$rootdir/BIOS/PCSX2" "$config_home/.config/pcsx2/bios"

	# User might have the idea to manually state a bios file in the terminal.
	# To save them exporting HOME as /home/user/.retrorig,
	# a symbolic link is created.

	date=`date`
	mv "$HOME/.config/pcsx2" "$HOME/.config/pcsx2.backup_retrorig.$date"
	ln -vs "$config_home/.config/pcsx2/" "$HOME/.config"

	#####################################################################
	# PPSSPP (PSP)
	#####################################################################

	echo "Installing Playstation Portable emulator ppsspp"

        # Install from ppa:ppsspp/stable. 11 weeks old as of 20150512
	$cmd_install_pkg $PKG_ppsspp

	#####################################################################
	# Stella (Atari 2600)
	#####################################################################

	# Libretro core does not support save states, use our package.
	# Needs built for Vivid. Binary copied, but needs tesed. If that fails,
	# source package will need rebuilt to Vivid release in RetroRig PPA.
	
	# Install from RetroRig PPA
	$cmd_install_pkg $PKG_stella

	#####################################################################
	# Yabause (libretro Sega Saturn core) 
	# Disabled for now (very slow!)
	#####################################################################
	
	# Install Yabause
	#echo "Installing Sega Saturn emulator Yabause"

	# Install desmume core
	# Use libretro* for all packages
	#$cmd_install_pkg retroarch libretro-yabause
	
	#####################################################################
	# Higan (Accurate Nintendo multi-system emulator)
	#####################################################################
	
	echo "Installing Nintendo multi-system emulator Higan"

	# Install from Ubuntu offficial repos (available since Trusty)
	$cmd_install_pkg $PKG_higan
}
